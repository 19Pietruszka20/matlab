clc
%3500 iteracji do ktorszego algorytmu na b 
%235 iteracji do d�u�szego algorytmu na b
format long
f = @(x)12220*x(1) - 15634*x(2) - 1306*x(3) - 162*x(4) + 62020*x(1)*x(2) + 4560*x(1)*x(3) + 540*x(1)*x(4) + 6804*x(2)*x(3) + 1026*x(2)*x(4) + 270*x(3)*x(4) + 57595*x(1)^2 + 32368*x(2)^2 + 706*x(3)^2 + 27*x(4)^2 + 11824;
n=0;
i=0;
E=0.1

Bb=[1 0 0 0;
  0 1 0 0;
  0 0 1 0;
  0 0 0 1;];

x2=[0;0;0;0];
x1=[-10;-10;-10;-10];
x1=[-0.48307;0.69950;0.049833;0.005256]
%x1=[1;2;3;4]

options = optimset('TolX',1e-6,'TolFun',1e-6,'MaxFunEval',1e50)

while(1)
    
d=-Bb*gradientf(x1);

fh=@(h)f(d*h + x1);
[h,y]=fminsearch(fh,0,options);

x2=x1+d*h;
dx=x2-x1;
dg = gradientf(x2)-gradientf(x1);
x1=x2;
%BbN = Bb + ((dx*(dx'))/((dx')*dg)) - (( Bb*(dg*(dg'))*Bb)/((dg')*Bb*dg))
 BbN=Bb+(1+((dg')*Bb*dg)/((dx')*dg))*((dx*(dx'))/((dg')*dx))-(((dx*(dg')*Bb)+(Bb*dg*(dx')))/((dg')*dx));
Bb=BbN;

   
n=n+1;
h
if(n==9 || abs(h)<1e-15)
    juz=0
n=0;
Bb=[1 0 0 0;
  0 1 0 0;
  0 0 1 0;
  0 0 0 1];
end
i=i+1;
if(norm(gradientf(x1))<E || i==10)
    x2
    f(x2)
    break
end
end

